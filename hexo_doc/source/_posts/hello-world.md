---
title: JavaScript函数的作用域及其使用规则
date: 2022-01-26 11:49:48
tags: javascript
categories: js小知识点
---
## 作用域
作用域，就是一个变量可以生效的范围，变量不是在所有地方都可以使用的，而这个变量的使用范围就是作用域。
 js划分作用域也是用大括号划分的, 但是js之中有效限定作用域的大括号只有函数大括号!
## 全局作用域
变量声明时没有被函数大括号包裹, 那么这个变量我们称之为全局变量。
在全局作用域中定义的变量可以在任何地方使用。
生命周期是和程序同步的，程序不关闭，变量就一直在；如果可能，少设计一点全局变量。
若要定义全局变量代码如下：

```javascript
var num=19;
var str="hellow world!";
//这两个均为全局变量
```
## 局部作用域
在函数大括号之中声明的变量， 这种变量我们称之为局部变量。
局部变量只能在声明它的作用域之中使用。
生命周期是和函数执行同步的，函数执行结束变量就被删除了。
若要定义全局变量代码如下：

```javascript
function foo(){
             var a = 10;//在大括号内定义局部变量
             console.log(a);
         }
      foo();
   // console.log(a);// 这个代码会报错报错，因为a是局部变量，只能在函数中使用;
```
## 伪全局变量
一个局部声明的变量，在全局可以被访问了，这样的声明叫做伪全局变量，其在函数中声明没有带var，如a=5。
如果我把局部变量变为伪全局变量，生命周期会变长了，造成一定负面影响，占据了全局命名空间造成不可预知的错误。
定义如下：

```javascript
function foo(){
             a = 10;
             console.log(a);
         }
         foo();
         console.log(a);//函数内外都可访问
```

## 使用规则
有了作用域以后，变量就有了使用范围，也就有了使用规则
变量使用规则分为两种，**访问规则** 和 **赋值规则**

## 访问规则

当我想获取一个变量的值的时候，我们管这个行为叫做访问
获取变量的规则：
首先，在自己的作用域内部查找，如果有，就直接拿来使用；
如果没有，就去上一级作用域查找，如果有，就拿来使用；
如果没有，就继续去上一级作用域查找，依次类推；
如果一直到全局作用域都没有这个变量，那么就会直接报错（该变量 is not defined）

```javascript
var a = 10;

function fn() {
  var b = 20;
  
  function fun() {
    var c = 30;
    
    console.log(c); // 自己作用域内有，拿过来用
    console.log(b); // 自己作用域内没有，就去上一级，就是 fn 的作用域里面找，发现有，拿过来用
    console.log(a); // 自己这没有，去上一级 fn 那里也没有，再上一级到全局作用域，发现有，直接用
    console.log(n); // 自己没有，一级一级找上去到全局都没有，就会报错
  }
  
  fun();
}

fn();
```
变量的访问规则也叫做作用域的查找机制;作用域的查找机制只能是向上找，不能向下找

```javascript
function fn() {
  var num = "小鱼儿";
}
fn();

console.log(num); // 发现自己作用域没有，自己就是全局作用域，没有再上一级了，直接报错
```

## 赋值规则

当你想给一个变量赋值的时候，那么就先要找到这个变量，在给他赋值
变量赋值规则：
先在自己作用域内部查找，有就直接赋值;
没有就去上一级作用域内部查找，有就直接赋值;
在没有再去上一级作用域查找，有就直接赋值;
如果一直找到全局作用域都没有，那么就把这个变量定义为全局变量，在给他赋值.

```javascript
function fn() {
  num = 100;
}
fn()

// fn 调用以后，要给 num 赋值
// 查看自己的作用域内部没有 num 变量
// 就会向上一级查找
// 上一级就是全局作用域，发现依旧没有
// 那么就会把 num 定义为全局的变量，并为其赋值
// 所以 fn() 以后，全局就有了一个变量叫做 num 并且值是 100
console.log(num); // 100
```

